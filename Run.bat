@echo off
:: Elevate window with administrator privileges, snippet from https://stackoverflow.com/a/52517718
set "params=%*"
cd /d "%~dp0" && ( if exist "%temp%\getadmin.vbs" del "%temp%\getadmin.vbs" ) && fsutil dirty query %systemdrive% 1>nul 2>nul || (  echo Set UAC = CreateObject^("Shell.Application"^) : UAC.ShellExecute "cmd.exe", "/k cd ""%~sdp0"" && ""%~s0"" %params%", "", "runas", 1 >> "%temp%\getadmin.vbs" && "%temp%\getadmin.vbs" && exit /B )

echo Running scans with administrator privileges

echo.
echo.
echo Starting "SFC /ScanNow" scan
SFC /ScanNow

echo.
echo.
echo Starting "DISM /Online /Cleanup-Image /CheckHealth" scan
DISM /Online /Cleanup-Image /CheckHealth

echo.
echo.
echo Starting "DISM /Online /Cleanup-Image /ScanHealth" scan
DISM /Online /Cleanup-Image /ScanHealth

echo.
echo.
echo Starting "DISM /Online /Cleanup-Image /RestoreHealth" scan
DISM /Online /Cleanup-Image /RestoreHealth

echo.
echo.
if exist "CHKDISK_scan.ps1"(
    PowerShell -file "CHKDSK_scan.ps1"
) else (
    PowerShell -encodedCommand "JABjAGgAawBkAHMAawBQAHIAbwBtAHAAdAAgAD0AIAAiAFcAbwB1AGwAZAAgAHkAbwB1ACAAbABpAGsAZQAgAHQAbwAgAHMAYwBhAG4AIAB3AGkAdABoACAAQwBIAEsARABTAEsAPwAgAFQAaABpAHMAIAB3AGkAbABsACAAdABlAG0AcABvAHIAYQByAGkAbAB5ACAAZABpAHMAYQBiAGwAZQAgAHQAaABlACAAYQBjAHQAaQB2AGUAbAB5ACAAcwBjAGEAbgBuAGUAZAAgAGQAaQBzAGsAKABzACkALgAgAFQAaABlACAAbQBhAGkAbgAgAGQAaQBzAGsAIABjAGEAbgAgAGIAZQAgAHMAYwBoAGUAZAB1AGwAZQBkACAAZgBvAHIAIABzAGMAYQBuAG4AaQBuAGcAIABuAGUAeAB0ACAAcwB0AGEAcgB0AHUAcAAgAHcAaABlAG4AIAB0AGgAZQAgAG8AdABoAGUAcgAgAGQAaQBzAGsAcwAgAHcAaQBsAGwAIABiAGUAIABzAGMAYQBuAG4AZQBkACAAbgBvAHcALgAgAEQAbwAgAHkAbwB1ACAAdwBpAHMAaAAgAHQAbwAgAHIAdQBuACAAdABoAGkAcwAgAHMAYwBhAG4APwAiACAAJABjAGgAawBkAHMAawBUAGkAdABsAGUAIAAgACAAIAA9ACAAJwBUAGUAbQBwAG8AcgBhAHIAaQBsAHkAIABkAGkAcwBhAGIAbABlACAAZABpAHMAawAgAHcAaQB0AGgAIABjAGgAawBkAHMAawA/ACcAIAAkAGMAaABvAGkAYwBlAHMAIAAgAD0AIAAnACYAWQBlAHMAJwAsACAAJwAmAE4AbwAnACAAIAAkAGMAaABrAGQAaQBzAGsARABlAGMAaQBzAGkAbwBuACAAPQAgACQASABvAHMAdAAuAFUASQAuAFAAcgBvAG0AcAB0AEYAbwByAEMAaABvAGkAYwBlACgAJABjAGgAawBkAHMAawBUAGkAdABsAGUALAAgACQAYwBoAGsAZABzAGsAUAByAG8AbQBwAHQALAAgACQAYwBoAG8AaQBjAGUAcwAsACAAMQApACAAaQBmACAAKAAkAGQAZQBjAGkAcwBpAG8AbgAgAC0AbgBlACAAMAApACAAewAgAAkAVwByAGkAdABlAC0ASABvAHMAdAAgACIAPdhM3DzY/d8iACAAIAAgACAAIABlAHgAaQB0ACAAfQAgACAAIAAkAGMAaABrAGQAcwBrAEMAbwBtAHAAcgBlAGgAZQBuAHMAaQB2AGUASABkAGQAUwBjAGEAbgBUAGkAdABsAGUAIAA9ACAAIgBVAHMAZQAgACcALwBSACcAIABwAGEAcgBhAG0AZQB0AGUAcgAgAGYAbwByACAAYwBoAGsAZABzAGsAPwAiACAAJABjAGgAawBkAHMAawBDAG8AbQBwAHIAZQBoAGUAbgBzAGkAdgBlAEgAZABkAFMAYwBhAG4AUAByAG8AbQBwAHQAIAA9ACAAIgBXAG8AdQBsAGQAIAB5AG8AdQAgAGwAaQBrAGUAIAB0AG8AIAB1AHMAZQAgAHQAaABlACAAQwBIAEsARABTAEsAIAAnAC8AUgAnACAAcABhAHIAYQBtAGUAdABlAHIAIAB0AG8AIABzAGMAYQBuACAASABEAEQAcwAgAGYAbwByACAAYgBhAGQAIABzAGUAYwB0AG8AcgBzAD8AYAByAGAAbgBUAGgAaQBzACAAaQBzACAAYQAgAG0AbwByAGUAIABjAG8AbQBwAHIAZQBoAGUAbgBzAGkAdgBlACAAcwBjAGEAbgAgAG8AcAB0AGkAbwBuACAAZgBvAHIAIABIAEQARABzACwAIAB3AGgAaQBjAGgAIAB0AGEAawBlAHMAIABsAG8AbgBnAGUAcgAgAHQAaQBtAGUAIAB0AG8AIAByAHUAbgAuACAASQB0ACAAYwBhAG4AIAB0AGEAawBlACAAbQB1AGwAdABpAHAAbABlACAAaABvAHUAcgBzACAAbwBuACAAYQAgAHMAbABvAHcAIABIAEQARAAsACAAdwBoAGkAbABlACAAdABoAGUAIAByAGUAZwB1AGwAYQByACAAcwBjAGEAbgAgACgAaQAuAGUALgAsACAAdwBpAHQAaABvAHUAdAAgACcALwBSACcAIABwAGEAcgBhAG0AZQB0AGUAcgApACAAaQBzACAAZgBhAHMAdAAgAGEAbgBkACAAbwBuAGwAeQAgAHQAYQBrAGUAcwAgAGEAIABmAGUAdwAgAG0AaQBuAHUAdABlAHMALgBgAHIAYABuAFQAaABlACAAUwBTAEQAIABzAGMAYQBuAHMAIAB3AGkAbABsACAAaQBnAG4AbwByAGUAIAB0AGgAaQBzACAAcABhAHIAYQBtAGUAdABlAHIAIABhAHMAIABpAHQAIABjAGEAbgAgAGMAYQB1AHMAZQAgAHQAaABlACAAUwBTAEQAIAB0AG8AIABzAGgAcgBpAG4AawAgAGkAbgAgAGQAYQB0AGEAIABzAGkAegBlAC4AYAByAGAAbgBEAG8AIAB5AG8AdQAgAHcAaQBzAGgAIAB0AG8AIAB1AHMAZQAgAHQAaABlACAAJwAvAFIAJwAgAHAAYQByAGEAbQBlAHQAZQByACAAZgBvAHIAIAB0AGgAZQAgAEgARABEACAAcwBjAGEAbgBzAD8AIgAgACQAYwBoAGsAZABzAGsAQwBvAG0AcAByAGUAaABlAG4AcwBpAHYAZQBIAGQAZABTAGMAYQBuAEQAZQBjAGkAcwBpAG8AbgAgAD0AIAAkAEgAbwBzAHQALgBVAEkALgBQAHIAbwBtAHAAdABGAG8AcgBDAGgAbwBpAGMAZQAoACQAYwBoAGsAZABzAGsAQwBvAG0AcAByAGUAaABlAG4AcwBpAHYAZQBIAGQAZABTAGMAYQBuAFQAaQB0AGwAZQAsACAAJABjAGgAawBkAHMAawBDAG8AbQBwAHIAZQBoAGUAbgBzAGkAdgBlAEgAZABkAFMAYwBhAG4AUAByAG8AbQBwAHQALAAgACQAYwBoAG8AaQBjAGUAcwAsACAAMQApACAAIABHAGUAdAAtAFAAaAB5AHMAaQBjAGEAbABEAGkAcwBrACAAfAAgAFcAaABlAHIAZQAtAE8AYgBqAGUAYwB0ACAATQBlAGQAaQBhAFQAeQBwAGUAIAB8ACAARgBvAHIARQBhAGMAaAAtAE8AYgBqAGUAYwB0ACAAewAgAAkAJABwAGgAeQBzAGkAYwBhAGwARABpAHMAawAgAD0AIAAkAF8AIAAJACQAZAByAGkAdgBlAEwAZQB0AHQAZQByACAAPQAgACQAcABoAHkAcwBpAGMAYQBsAEQAaQBzAGsAIAB8ACAARwBlAHQALQBEAGkAcwBrACAAfAAgAEcAZQB0AC0AUABhAHIAdABpAHQAaQBvAG4AIAB8ACAAVwBoAGUAcgBlAC0ATwBiAGoAZQBjAHQAIABEAHIAaQB2AGUATABlAHQAdABlAHIAIAB8ACAAUwBlAGwAZQBjAHQALQBPAGIAagBlAGMAdAAgAC0ARQB4AHAAYQBuAGQAUAByAG8AcABlAHIAdAB5ACAARAByAGkAdgBlAEwAZQB0AHQAZQByACAACQBpAGYAIAAoACQAZAByAGkAdgBlAEwAZQB0AHQAZQByACkAIAB7ACAACQAJAGkAZgAgACgAJABjAGgAawBkAHMAawBDAG8AbQBwAHIAZQBoAGUAbgBzAGkAdgBlAEgAZABkAFMAYwBhAG4ARABlAGMAaQBzAGkAbwBuACAALQBlAHEAIAAwACAALQBhAG4AZAAgACQAcABoAHkAcwBpAGMAYQBsAEQAaQBzAGsALgBNAGUAZABpAGEAVAB5AHAAZQAgAC0AZQBxACAAIgBIAEQARAAiACkAIAB7ACAACQAJAAkAJABtAGUAcwBzAGEAZwBlACAAPQAgACIAYAByAGAAbgBgAHIAYABuACIAIAArACAAJwBTAHQAYQByAHQAaQBuAGcAIAAiAEMASABLAEQAUwBLACAAJwAgACsAIAAkAGQAcgBpAHYAZQBMAGUAdAB0AGUAcgAgACsAIAAnADoAIAAvAEYAIAAvAFIAIAAvAFgAIgAgAHMAYwBhAG4AJwAgACsAIAAiAGAAcgBgAG4AIgAgAAkACQAJAFcAcgBpAHQAZQAtAE8AdQB0AHAAdQB0ACAAJABtAGUAcwBzAGEAZwBlACAACQAJAAkAIAAJAAkACQBDAEgASwBEAFMASwAgACQAewBkAHIAaQB2AGUATABlAHQAdABlAHIAfQA6ACAALwBGACAALwBSACAALwBYACAACQAJAH0AIAAJAAkAZQBsAHMAZQBpAGYAIAAoACQAcABoAHkAcwBpAGMAYQBsAEQAaQBzAGsALgBNAGUAZABpAGEAVAB5AHAAZQAgAC0AZQBxACAAIgBIAEQARAAiACAALQBvAHIAIAAkAHAAaAB5AHMAaQBjAGEAbABEAGkAcwBrAC4ATQBlAGQAaQBhAFQAeQBwAGUAIAAtAGUAcQAgACIAUwBTAEQAIgApACAAewAgAAkACQAJACQAbQBlAHMAcwBhAGcAZQAgAD0AIAAiAGAAcgBgAG4AYAByAGAAbgAiACAAKwAgACcAUwB0AGEAcgB0AGkAbgBnACAAIgBDAEgASwBEAFMASwAgACcAIAArACAAJABkAHIAaQB2AGUATABlAHQAdABlAHIAIAArACAAJwA6ACAALwBGACAALwBYACIAIABzAGMAYQBuACcAIAArACAAIgBgAHIAYABuACIAIAAJAAkACQBXAHIAaQB0AGUALQBPAHUAdABwAHUAdAAgACQAbQBlAHMAcwBhAGcAZQAgAAkACQAJACAACQAJAAkAQwBIAEsARABTAEsAIAAkAHsAZAByAGkAdgBlAEwAZQB0AHQAZQByAH0AOgAgAC8ARgAgAC8AWAAgAAkACQB9ACAACQB9ACAAfQAgACAAVwByAGkAdABlAC0ATwB1AHQAcAB1AHQAIABgAG4AIABDAE0ARAAgAC8AYwAgAFAAQQBVAFMARQA="
)

echo.
echo.
echo Scan completed

echo.
pause
exit